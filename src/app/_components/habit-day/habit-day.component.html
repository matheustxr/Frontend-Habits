<div class="relative w-full flex justify-center" #triggerWrapper>

  <button
    type="button"
    (click)="toggle()"
    class="w-10 md:w-12 h-10 md:h-12 rounded-full p-0.5 flex justify-center items-center cursor-pointer transition-all duration-300 ease-in-out"
    [ngStyle]="{
      backgroundImage: 'conic-gradient(#7c3aed ' + completedPercentage + '%, #18181b ' + completedPercentage + '%)'
    }"
  >
    <div class="w-full h-full bg-zinc-900 rounded-full flex items-center justify-center">
      <span class="text-sm text-white font-bold">{{ date | date: 'd' }}</span>
    </div>
  </button>

</div>

@if(isPopoverOpen){
  <div
    #popoverContent
    [ngStyle]="popoverStyle"
    class="fixed z-50 w-72 md:w-80 max-w-[calc(100vw-16px)] rounded-xl bg-zinc-900 p-6 shadow-lg"
  >
    <div
      class="absolute w-3 h-3 rotate-45 bg-zinc-900"
      [style.left]="'var(--arrow-left-position)'"
      [style.transform]="'translateX(-50%)'"
      [class.top-[-2px]]="!renderAbove"
      [class.bottom-[-2px]]="renderAbove"
    ></div>

    <div class="flex flex-col">
      <span class="font-semibold text-zinc-400 capitalize">{{ dayOfWeek }}</span>
      <span class="mt-1 font-extrabold leading-tight text-3xl text-white">{{ dayAndMonth }}</span>
      <app-progress-bar [progress]="completedPercentage"></app-progress-bar>
      <app-habits-list
        [date]="date"
        (completedChange)="handleCompletedChanged($event)"
        (editHabit)="onEditHabit($event)"
      ></app-habits-list>
    </div>
  </div>
}
