<button
  (click)="toggleMobileMenu()"
  class="fixed top-4 left-4 z-50 text-white p-2 rounded-md bg-zinc-900/50 backdrop-blur-sm md:hidden"
  aria-label="Abrir menu"
>
  <i class="pi pi-bars text-xl"></i>
</button>

@if(isMobileMenuOpen){
  <div (click)="closeMobileMenu()" class="fixed inset-0 bg-black/60 z-30 md:hidden"></div>
}

<aside
  [ngClass]="{
    'w-64': !isCollapsed,
    'w-20': isCollapsed,
    'translate-x-0': isMobileMenuOpen
  }"
  class="bg-zinc-900 p-4 fixed top-0 left-0 h-full flex flex-col transition-all duration-300 ease-in-out z-40 transform -translate-x-full md:translate-x-0 md:relative"
>
  <button
    (click)="toggleCollapse()"
    class="hidden md:flex absolute -right-3 top-12 bg-zinc-800 text-zinc-400 hover:bg-violet-600 hover:text-white rounded-full h-7 w-7 items-center justify-center transition-colors z-10 cursor-pointer"
  >
    <i class="pi" [ngClass]="{ 'pi-angle-double-right': isCollapsed, 'pi-angle-double-left': !isCollapsed }"></i>
  </button>

  <div class="flex-1 flex flex-col overflow-hidden">
    <img
      src="/logo.svg"
      alt="Habits"
      class="mx-auto mb-10 transition-all duration-300"
      [ngClass]="{ 'w-32': !isCollapsed, 'w-10': isCollapsed }"
    />

    <nav class="space-y-2" (click)="closeMobileMenu()">
      @for (link of mainNavLinks; track link.label) {
        @if (link.label === 'Dashboard' || authService.isLoggedIn()) {
          <a
            [routerLink]="link.routerLink"
            routerLinkActive="bg-violet-600 !text-white"
            [routerLinkActiveOptions]="{ exact: true }"
            class="flex items-center gap-3 p-3 rounded-md text-zinc-400 hover:bg-zinc-800 hover:text-white transition-colors"
            [title]="isCollapsed ? link.label : ''"
          >
            <i [class]="link.icon" class="text-2xl min-w-[2rem] text-center"></i>
            <span class="font-semibold whitespace-nowrap md:hidden" [class.md:inline]="!isCollapsed">{{ link.label }}</span>
          </a>
        }
      }
    </nav>

    @if(!isCollapsed) {
      <div class="mt-auto">
        @if (!authService.isLoggedIn()) {
          <button
            (click)="openAuthModal()"
            class="w-full flex items-center gap-3 p-3 rounded-md text-zinc-400 hover:bg-zinc-800 hover:text-white transition-colors"
          >
            <i class="pi pi-sign-in text-2xl min-w-[2rem] text-center"></i>
            <span class="font-semibold whitespace-nowrap">Entrar</span>
          </button>
        }

        @if (authService.isLoggedIn()) {
          <hr class="border-zinc-700 my-4">

          <nav class="space-y-2">
            <p class="text-xs font-bold uppercase text-zinc-500 px-3 mb-2">Conta</p>
            @for (link of settingsActions; track link.label) {
              <button
                (click)="link.action()"
                [attr.data-testid]="link.label"
                class="w-full flex items-center gap-3 p-3 rounded-md text-zinc-400 hover:bg-zinc-800 hover:text-white transition-colors text-left cursor-pointer"
              >
                <i [class]="link.icon" class="text-2xl min-w-[2rem] text-center"></i>
                <span class="font-semibold whitespace-nowrap">{{ link.label }}</span>
              </button>
            }
          </nav>

          <button
            (click)="logout()"
            class="w-full flex items-center gap-3 p-3 rounded-md text-zinc-400 hover:bg-zinc-800 hover:text-white transition-colors mt-2 cursor-pointer"
            data-testid="logout-button"
            [title]="isCollapsed ? 'Sair' : ''"
          >
            <i class="pi pi-sign-out text-2xl min-w-[2rem] text-center"></i>
            @if (!isCollapsed) {
              <span class="font-semibold">Sair</span>
            }
          </button>
        }
      </div>
    }
  </div>
</aside>
